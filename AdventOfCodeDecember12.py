# AdventOfCode 12.12.2023

# Explanation: In the giant field just outside, the springs are arranged into rows. 
# For each row, the condition records show every spring and whether it is operational (.) 
# or damaged (#). This is the part of the condition records that is itself damaged; for 
# some springs, it is simply unknown (?) whether the spring is operational or damaged

example1 = """???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1"""

example2 = """.?#??.??#???.?? 2,6,2
?#??.?#.???#. 3,1,3
.#??#?#?.?##?#. 6,5
.#???##??.# 7,1
..#..??????#?#.#.#? 1,9,1,2
????#???????#????? 1,8,1,1,1
??#??#???#????????? 10,2,1,1
?#?.?##.?? 2,2,1
?..#.????.?#???#??? 1,1,1,1,8
????#??.#???? 4,1,1
????#.#.????? 5,1,2,1
?.??#????##????#.#? 1,1,4,3,1
.???..???####?? 2,7
??????????#.#???#?? 1,4,2,1,1,4
?????.??????? 4,3
?.?#?#??#?#????#??.. 9,4
..##??????#????##?? 3,5,4
?????#?##????#?.. 10,1
?##????#???#?.? 9,2
.??#.???????#?.???.? 1,7,3
????????###?#? 1,6
?#????#?.???? 1,1,2,4
?##?..?#.??.??#?# 2,2,1,1,3
?#?#?????. 7,1
.##?????#?????? 2,5,1,1
?...??????..?#? 1,1,1,1,3
?.#.?..?#?.? 1,1,1,1
??????###.???.. 1,3
?.?.?????###?.??#? 1,1,8,1,1
?#?????#??.??#??. 1,1,3,2,1
#?.?.??.????????.#. 1,2,6,1
?.?#????..?.?.?###. 3,2,1,3
#??#?.?#?#?.?#?????. 1,3,1,2,6
??.??#?#??## 1,7
??#??????#??????#?? 4,4,5,1
???#??##???. 4,5
????????.???##???#. 1,1,1,2,9
..#??..????????#.?#. 3,2,3,1,1
?#?????#?? 2,5
#??#?.???#.? 1,2,1,1
??#??.?.??? 4,1,2
.#.#.#??.???#?? 1,1,3,3
???#??#??.????? 8,4
?.??#?#?.??.#.? 5,1
???.?#?????##?#????? 1,2,7,1
??..???..??. 2,2,1
.????#??#?? 6,2
?.#.?...?#???#? 1,1,6
.?.#.????#?#??.?#.? 1,6,2
??#..#?????#??#???? 1,1,1,9,1
?????###??##??? 7,4
??????.??????#??#? 1,1,1,2,7
??#??????..? 1,4,1,1
??????.?#. 2,2
???#?.#?.? 4,2,1
#???#?#?????? 5,2,1
???#?#??.???..#.?## 8,1,1,1,3
??.??##???.? 2,5
?##??#?.#?. 6,2
??.?.?#####??#??? 1,1,5,5
?????##?##????.?# 1,7,1,2
?????##?#??##???#?. 2,9,1,1
???.????????#.. 1,1,1,2,1
.?????#???? 7,1
?????.#??#?#?#? 1,9
###????..#???#?? 5,1,2
???#?...??? 4,2
???.?.????#. 1,1,3
??#???...??????. 1,4
??#????..? 3,1
#.???#?#####??.???? 1,9,1,1
?#?#?????#???? 1,4,1,3
#?.#.?#???#?.??????? 1,1,4,1,3,2
????#?????##?#?#? 6,7
???#???.?#?##????? 2,6,1
.?#?????.??.????? 4,1,1,1
#..?#####????. 1,7,1
.?#.?#??.??#?? 1,1,1,3
??????#?.#?#?#?#?? 1,1,7,1
??#???.???. 5,1,1
.??#??????#???...#?? 11,3
??#?.?.?????##?... 2,7
?#?????###.?#???? 2,6,4
#..#.#??.. 1,1,3
.??.?????.? 1,4
??#?#????????????#? 4,1,5,1,3
?##?#??##???.? 5,2,1
?#????#?#???? 4,1,1,1
?.?#?#?.??#?? 5,4
.#.??#?##.? 1,6,1
?#.?.??????.#?? 1,1,1,1,2
?#??#????##..#.????? 1,7,1,1,1
?.??????#??# 1,4,1,1
.????##???#???? 1,8
??#?##?#?. 1,5
???#????????##.????? 3,2,3,2,1
?#???.???#????#???? 1,1,1,2,1,5
??#???????????#? 7,1,3
?.???#??#?.? 2,4
?#????#???#????? 3,9,1
???????.??##???. 1,4
???.????.???.?? 1,1,1,1,1
????#????.??#?#? 5,1,1,1,2
..??????.??????.?. 4,1,3
.#???##????#???#?? 1,1,3,1,3,2
.??..##?.???? 1,2,3
##?????????????#???# 4,2,1,1,1,1
###.??#??#???? 3,2,6
??#???.??????.# 1,1,1,2,1
????#?##??.??#??? 1,4,4
?##?#?#?????#??.#?. 9,3,2
???#?.??..?? 1,1,2,1
?#?.?.???#?.?????? 1,1,3,1,1,2
???####???#????.#?? 1,8,1,1,1
??????#?#??#.????.? 1,1,7,2,1
??????????..??.? 2,5,1,1
???#?#?.#??#????. 1,3,2,1,1
.??#???#?.???#???? 7,5,1
?????...?##?. 2,2
??#.##??????#???#?? 2,3,1,1,3,3
##?#?????#?.? 4,1,1
?#??.#??#?? 1,1,2
?.?#?..#???#. 2,1,1
.???.#?#???#???#..? 3,11
???#?.#?.?##? 4,1,3
?????.??.? 1,1,1
.????.???.??????? 1,1,6
.???????.?#?#??#???# 3,2,11
??#???#??.#???? 8,1,2
????#?#??.?.? 1,4,1
?#?#??#???.?????# 2,5,1,1,1
??#???.?#.. 4,2
.?.#???#?.??? 2,2,2
?.??..???#?? 1,3
???.????###?###????# 1,1,12
??##???????...#??.. 2,5,3
#?#?#?.???????????#. 1,3,2,8
???????#???.???. 1,6,1,1
?##???????.??????. 8,1,2
???##??.#? 5,2
?????###??????.##??? 1,9,1,3,1
..#.#?#??##.???..? 1,1,1,3,3,1
???###???#???????. 7,5,1,1
#?.??????##??#?. 2,10
?????#?.?? 4,1
??.??#?.????? 3,3
??#?.???????? 2,5
?##..??#?#??#?##?.?. 3,1,9,1
?.?????.???? 4,3
.?#??????.?#??? 3,4
?###?????????????##? 6,9
???#????#???. 1,5,4
#??#?.??.?.? 5,1,1,1
?.??#..??.#?? 1,1,3
##?##?##.? 2,5
?#??#??#?. 5,2
?#?..?#.#??#???##?? 2,2,9
???..#??..?? 1,1,1,1
?...?#.??.??? 2,2
???##????.???? 1,4,2
??.??..??.. 2,1,1
???#?????.? 5,1
.??????????#??.??? 1,1,1,5,1
????#?#????????#?## 1,2,2,9
.????#.?.? 1,1
???..?#?#???? 2,4,3
???#?????.#? 1,6,2
.????.???#?#.?# 1,1,4,1
?##???#???.?##?# 6,5
.??#.?????#?#?? 1,9
???.????##?#.???.?? 1,2,5,1,1
?..?#??#?#?####? 7,4
??##???#???.???.#??# 4,6,1,1,1,1
????.?#?#???#? 2,5
???...?#??? 1,3
??#?#?##??????##?#? 15,1
.?#??#??#???#???. 9,1,1
??????.#??#???.#.??? 1,1,1,5,1,1
??.?.???#?? 1,1,3
?#.??.?#??????? 1,1,2,2
????##?#??. 6,1,1
????.???????.?.??? 1,1
.??.??#??????#?? 1,10,1
?#?..?#???#??? 2,8
..???#??#?#?? 1,4,2
??????.#???#. 1,3,1,3
??##??.??. 5,1
????##???#.??#?#.?? 6,1,1,3,1
.#??#?##????? 1,8
..?????.??# 1,1
?#????.?#?#? 4,1,3
????????#???#?#??.?? 1,12
??#???.?.?????#???? 2,1,1,3,2,2
????.##??#????? 2,6,1
??????#?.????? 6,2
?.???#?#?#??#???#. 4,3,1,2
.????????.?#??????.? 3,1,7,1
??###?##?????? 10,1
..?.?#??#??. 1,6
??#?#??.?##?# 1,3,2,1
###???###???#..?##?? 10,1,3
???????#?? 3,3
??###??#??...?#..#? 6,3,2,2
??#?????#?????#.? 8,1,1
.?#???.???????#? 5,2,1,2
..?????.??.## 1,1,1,2
?#????????#? 3,3
#???#?.??.??? 1,1,1,2
?#.??.#?????.???? 1,1,4,1,1
?????????#??? 2,3
?..??####? 1,5
??#??#?##..##? 6,2,2
???#.?.??.???? 1,1
??????.?????##?#? 1,1,1,1,8
???#????.??? 1,1,2,3
??#?#??##?#?.?#. 10,2
##???#?.???? 6,1
..?.#????#?#?. 1,6,2
???????.?..?????? 2,4
#??#.#???##... 4,6
??.?.?????? 1,1,3
??.?.??.?#?#?####??? 1,8
..#?#??.?#?#???. 4,6
???.???#?#?#??? 1,8
.???.?.????.??.?? 2,1,4,1,1
?.?.?#?.?###? 1,1,4
#.??#?.##? 1,3,3
???#?????###???#?#?? 1,1,1,10
???.????????#?# 1,4,3
..???????#? 5,1
?????#.?????????. 2,3
?#????##.?.?.????. 7,1,1,1,1
?.#??#.??? 1,4,1
#?.??#???????##??# 1,4,1,1,3,1
???.?##???#??##????? 1,7,3,3
#????#??#?#??????? 2,11
???#?#??##? 1,8
??.???????#??# 1,6,1,1
??????????#.##????? 1,2,1,2,2,1
.?????????.???#??.? 4,1
..???#..??? 2,2
.?#????????#?# 1,1,5
?#?#??????##????? 7,3,2
??#??##?.???..??#... 5,2,3
?.?.????????.??? 1,1,5,2
?????#?##??.#??? 3,2,4,3
???..?#.?###??## 3,2,5,2
.???.??#??. 2,5
#???#.?#????#? 2,1,3,4
##.?????#?.?????? 2,1,3,1,2
?##????.??? 2,1
#.?#?.?????????# 1,1,1,7
??.?#??#?.?? 2,1,1,1
#???##?#?????.??? 3,8,1
?#?????#????#?.?? 5,2,1,1
?.?????????#? 1,1,1,3
.???????#?.?.? 1,1,3,1
?.???????#?#?#??? 1,2,6,3
.?.????????. 1,1,1,1
????#?.????.?? 5,1,1
?.??????#?..??# 1,1,2,1,1
??#??.??.???# 4,1,4
???.?#?#?#???.#?.??# 2,8,1,1,1
????.??#?????.? 4,3,2,1
????#?????? 3,1
?.?##?#???#??.???? 1,10,1,1
.?#?????????####?? 3,3,8
#?????.??.?#??? 6,3
.?#.?????????#?####. 1,4,8
???..?#???#???#???. 2,1,2,4,1
???.#?#?#???????.?# 7,2
?#????????? 1,1,2
#??#???#?.???.?.? 5,2,2,1
?????.?.?. 4,1
?.#?...?##? 1,1,4
??#?.??#??????#?#?#? 1,1,15
??#?..?.?? 2,1
#?????..?? 1,1,2
#??##??????#?.???. 8,1,1,3
?...????#?#?.?#??. 6,1
.???????.? 1,2
?#??????.??.??.#? 8,1,1
???.??..?#?#?. 2,1,4
????#?#?.#?????? 1,1,3,1,5
.???.???.? 1,1,1
?????#?????.?.#?? 3,2,1,3
????????.# 7,1
???#??.?.#?? 2,1
.?##???.??? 3,2
?.?##.??#????. 2,7
#??.?#????????#??#?? 1,1,11,1,1
???.?.?.?.?#..? 1,2
.????#?????#??.??? 12,1
?????#?..????##?# 2,1,6,1
?????..#?.?# 3,2,2
??.??????#.#?????? 1,1,2,1,1,2
???.#?..?..?????? 2,1
??##?#?????.? 6,2
?.?????#?#?. 2,4
?#???#???#???.????? 1,3,3,1,1,1
.#????#?.?.?#????#? 4,2,1,1,2
??#??#??#..??.?.??. 7,1,1
#??.??#???.##. 1,4,1,2
????.??????###..???? 1,2,1,7,1,1
?????##??#???????.?. 8,1
???.?#.?##??????# 3,1,7,2
??..??????.?? 1,1,2,1
????????.##????#? 3,3,2,1,1
??.?#????##?#? 2,6
.#?#???????? 3,1,1
???.???#?? 1,3
??????#???.???#????? 1,7,5,1
#?#.???.???# 3,2,1,2
?.???#??.??.?..?#??? 2,1,2
???.????#????##? 2,2,3,4
???#?????.?? 1,1,2,2
?#.#??..#?#? 2,3,4
???#?????#?#.????#?. 2,7,4
?????#??.????. 3,1
??????????????#?#. 1,1,7,1,1
??#.#??#????. 1,2,1,1
?.###?.?#.? 1,4,1
????##?#?.?????#?.## 2,2,2,2,3,2
????.#..?#???#? 3,1,4,1
??##??##??.??.?#??#? 8,2,5
??#??#???? 1,1,2
#??#..?.???????. 1,1,1,4,1
#??#?.??????#???#?? 1,2,10,1
#?##?#??#???##??#?. 1,2,5,3,1
?#??###..? 2,4,1
????????.?.?? 6,1
.?#??????? 5,1
.?#?????.. 2,1
?.????..?????##? 1,1,1,1,4
.##?.?????? 2,2
?????.##??##?#??? 2,2,6
#???.??#?????#????# 2,1,12
???.??#?????.? 1,1,4,1
????###???##?? 1,9
#.???.??#???# 1,1,4,1
..???#?????#??#. 1,2,1,4
#???##???#?#?????# 1,13,1
??#?#?.#???.##??.??? 1,4,3,4,3
?..??#????? 1,1,3
?.??#.???#.. 1,2,1,1
??????##???.???#. 1,6,3
????.#????? 2,3
.#?..#?#?#.. 1,1,1,1
.???#????##?????#? 1,2,10
.#.?#??#????? 1,3,2,3
?.???###?. 2,4
????????.?????? 1,1,3,1,1
????????##?#??? 2,7
?.????#.??#?# 1,2,2,3
.??##??????#???#???? 6,8
?#??#?#??.??#?#?? 1,4,6
#???????.??. 1,1,1,1
????.????..??? 3,2,3
?.???#??#.?.???? 1,1,1,2,3
?.#??#??.#???#?#???? 1,1,1,1,1,8
?###..#?????.?#? 4,1,3,1
??????#????????? 1,4,1,1,3
???????#???#??#?? 1,6,5,1
..??##?#?.???.? 5,3
#???.??#?.??#? 1,1,3,3
#?????????. 1,1,3
???????#???? 3,1
?????#??#???#??.? 1,8,1,1,1
??.???..??#?? 3,3
...????#??#?.??#?# 2,4,5
..#?#.?..? 3,1
#???.?.#??.??? 4,1,1,2
.?#.?.??.. 2,1,1
???????.??.??????? 4,1,1,1,3
??.??.????. 2,1,1
?.???????# 1,5
?????.????.. 5,2
??#?????#?.?? 2,2
#.?.?.??#? 1,1,2
.??#????.#.????#? 2,1,1,6
??#??#.????##? 1,1,3,3
??#??.?##???.??..??? 2,4,1,1,3
??????..?# 2,1,2
.???#??.##.? 3,2
?????#????.?.#?.# 1,7,1,1
??##??#????.# 5,3,1
?#?.?????#?# 1,2,3
.?#?.????#??#?#???# 3,6,1,1
..??####??#??..? 1,4,4
#.?#.??#.?? 1,1,3
???????#???????.? 4,2,1,1,1
??????.?.? 2,1
??????..#??? 4,1,2,1
?.?.?????##??? 1,1,6
?????#?#?#??? 1,1,7
?#????????? 1,1,2
??????#.?.??..? 1,2,1,1,1
.#?.?.#???.#?. 1,1,1,2
?..?##???.#.??#??# 1,4,1,1,6
.??#??##?????.?#?? 7,1,3
?.#???????.?.? 1,1,3
.???.?.#??.????? 1,1,3,1,1
.???????#?.??.#??.?. 6,1
#??.???#??.?.???#?. 1,5,5
??.???..?.??????? 1,2,1,1,5
#???#??#????.#. 1,1,1,5,1
????.?#???? 2,3
???##?#?#?? 2,3,1
??#?.?.#??? 3,1,1
?.??.???.??????##. 1,1,1,8
.?.#?????#?#???#?..? 1,1,7,1,1
#???????????#? 1,2,1,4
.???#??##??????.#?#? 10,3,1,2
???..??????#??? 2,6,1
.???????#????. 1,5
??????#.?#?##.. 5,2,2
??.???????#? 1,2,6
??#???#??#??????#. 12,1,1
#???#.#.????#?#??# 1,3,1,5,1
????.##??#?#?#? 2,3,5
.?###?.????? 5,1,1
???.????.?..????. 2,4
?.#?..???? 1,2
?#????#??##?#????#. 6,9
?.??#???.?.??. 1,4,1,1
.#????#??#??##??#? 1,10,3
.???#.??????# 1,1,1,3
?.?.?##?.?.???#? 1,2,4
??#????#??#???.?#??. 13,4
?#??.?????##?.??? 3,5
?#????#?#???.???#??? 2,1,5,7
??.??###????#?? 4,1
?#???#????.? 2,4,1,1
???.?##?###?. 3,7
#??##???#.????#? 9,3
???.#??#????#?. 1,1,1,1,3
#???#?##?.? 2,2,2
???##?????.?##.? 7,2
???###??#?? 5,2,1
??..???#..??#?????.. 4,7
???##??###.?##? 8,3
???.???#.?.?????. 1,4,2
???.????#?????? 1,1,1,1,1
?#?.?????####?.? 2,2,5
#??#?#?#???..##?? 1,6,2,2,1
##????.#?? 3,3
????.??#.?#.?#???.?? 1,1,1,2,5,1
?.#?????#?##??? 1,1,1,5,2
????#?.??..??.?.? 4,2
??#?##.??#??????.# 6,1,1,1,1,1
??.???#?.#.# 1,4,1,1
.?..#?##?#???. 1,1,2,3
???????.?????#?#. 1,3,2,4
?????..???.????. 3,3,2
#?###???.? 5,1,1
????.#.?..#????? 2,1,1,4,1
????#?#??#?? 1,1,2,3
????#.?.???? 1,1,1,2
???.#??#???????? 2,4,2,3
?..???????#???????.. 1,1,5,2,2
.?.???#?##?###?# 10,1
#??.?????##?#????. 2,12
????.#?.??.???#?#? 1,1,2,1,7
.??#????#?? 1,1
#??.?#???.??#???# 1,2,1,2,2
??#?????#???????. 1,8
???#???.????? 5,1,1
#???.???##???#. 4,1,2,1,1
?.????#.#???##? 1,1,1,7
??#?????##??.? 1,7
.?#.?.?#.? 1,1
.?###?##?#?#? 3,6
?????.??##.? 1,1,1,2
??????????. 1,1
?.?????#?#?#?..#? 11,1
??#???.##???. 3,2,2,1
???#?????????.?. 3,2
?#?#?#???..#????#?## 7,9
????.??.??? 3,1,1
#.?.#.?.?#????#???? 1,1,1,11
?##??##????#.?? 3,6,1,1
#?.#???.?#??????? 2,4,2,1
###.???#.. 3,1,1
.##???#..#? 4,1,1
???????.#?. 3,2
#??#???.?????????? 7,1,1,2,1
?#??#???????????..?? 10,3,2
#???.?.???#?????? 3,1,8
?????.?.?????##.?#? 1,1,1,5,2
#???.?????#????? 1,2,1,7
??.??.???.?. 1,1,1,1
.?.???????????. 1,8
????.#?#???.??? 1,3,1,3
???.????.????###???? 1,1,6,2
?.???????. 1,7
?????#??????.??.?? 1,1,3,1,2,1
.??????##.?? 8,1
?#???#?#???#? 1,1,5
#??#?#..?? 4,1,2
?????.??.? 4,1
.?????#???. 1,6
??#?##??#??##??#??#? 6,11
??#??##.????#?????#? 3,3,1,1,1,2
???.????????.?#?# 1,3,2,4
?###??.???? 5,2
?##???????.#??.#???# 10,1,2,1
.??.??????#??# 1,3,1
#???#?????#???# 1,6,1,3
?????#.?#?#????## 1,1,6,2
.?#?#??#??#?#? 2,2,7
??????##?????#?#?#?? 10,3,1,1
??.???.??#???? 1,2,4,2
????#.??..?#????.??# 1,1,1,1,6,1
??.#???#??#?#??. 1,2,1,4,1
?#?##??#.##. 4,1,2
.###?.?????.?? 3,2,1,1
??????.?.#??.???#? 2,1,4
??#??#?.#.#?????##.? 1,1,2,1,8,1
.#?#???.??# 4,3
?..##??..??.. 1,3,1
#???????.?? 4,1,1
?#??.???#??.? 4,2
????#?????#..?. 1,2,4,1
#??#??#??#.??##??# 10,3,2
?.???.?.#?? 2,1
#??.??#???????.?#? 1,1,3,1,1,1
?.??#?##???##.. 1,3,2,2
?#????#??? 2,4
??#???.?#?##??##. 1,2,1,6
.?.?.???????##?#???? 1,2,2,9
??#.???????? 1,5
???#??.?#. 4,2
.??.#??..##?.? 1,3,2,1
???.?..?#.? 3,1
#?.?#???#?. 1,1,2
????#.??##?????#?# 3,5,1,3
?????.?.??#? 1,1,1
??????????.? 6,1
?????#????.??##?? 1,6,1,5
.???#.???????##?#?#? 2,12
????#?###??#?.?##?? 1,6,1,5
??.?..??.# 1,1,1
????????#?#?..???# 2,1,5,1,1
.??..?##????? 2,3,1
??##??..?.?. 4,1
#..#.#??#?#?#??# 1,1,2,8
??#.#????#?? 2,2,1,1
#????##???#..?#????. 11,1,1
?#?.#?????????# 2,1,4,3
?#????.??..#? 2,1,2,2
.???#????? 1,1,2
?.???#????.#??# 1,5,2,1,1
#??##?#?????#?? 1,2,5,1,1
#???????.#?.#. 2,2,1,1
??.??.#?.????..#.? 2,1,1,2,1,1
???.????## 3,1,2
????#?#.???? 7,1
#?????#??##?### 1,1,10
#?.?#???????..#? 1,9,2
#??????#??????# 1,1,1,5,1
.???#??????? 6,1
?.?.????#?#####?# 1,1,2,7,1
?..???.?????# 1,1,3
?###?????????..# 7,1,1,1
??#.?#.??. 1,1,2
#?#..#??.??? 3,1,1,2
?.?.??.?.#?? 1,2,1,2
??#??.#?#??#..?.?? 4,1,1,1,1,1
??????##.??????? 7,2,2
???#?.???.#??#.?.?.# 4,1,1,2,1,1
?#??#?#?????.#???#. 9,1,1,2
?????#??#???.? 1,9,1
#?#?#??#??????. 1,8,3
?????.#???? 3,5
?.??.??..#? 2,1,1
#.?.?#???.? 1,3
?.?#?#??.##. 4,2
??.#..??#. 2,1,1
???????.#.?? 1,1,1,1
?.????#???##????#..? 7,7
???.?##?##?????? 1,2,3,3
???#?##??#?.???.???? 1,5,2,1,1,1
.?#?????#?????? 2,6
?????#.???. 3,1
???##?#??.#???#? 1,7,3,1
.??#?#??.???.#???? 2,1,1,2,1,2
?##??.?#????# 4,1,2
.#???#???.#???#??.? 8,1,4
?.?##?##??#????#?. 10,2
.?????##.???.?? 2,2,2,1
#????..?#?.#??? 5,1,2
.#?.#.???? 1,1,3
??#??????? 1,5
??????.???. 3,1
?#?##?.??? 4,1
#.???#??#??#??#?? 1,7,1,2,1
.?????.??# 3,1
?.??????.?.##???#??? 3,1,2,3
????#???.?.?.?.?#? 1,4,1,1,1,3
##????##??..#.??. 2,5,1,1,2
?#???????? 6,2
?#?##.?????##??? 5,2,1,4
.??##?.??.? 2,1,1
#?????????##?? 2,1,1,4
????.??##???.????? 4,3,1,3
?..??##??.? 1,4
.##?.??.?? 3,1,1
??#??#?#?.?? 2,3
?????#??.??#?.????? 2,4,1,1,1,1
??.???#??#?? 1,5
?#???.???# 4,1,1
?###?????.?#... 5,1,1
.???##??.?#? 5,3
???????.?...??.##??# 3,1,1,1,5
.???????##??##? 2,2,7
?#..#??#?.#?# 1,2,1,3
??????????.????#?# 2,1,1,1,2,4
??#??????.. 5,2
?#????#??#?#??.?.#. 3,1,3,1,1
#?#..?####???#?? 1,1,9,1
#??#??.?????? 1,3,5
??????????.???.??? 1,1,1,1,2,1
??.????#??#?? 1,1,1,3
??????.#?? 1,1,3
?.#????#???#????#?? 2,2,5,2
?#???.??.?. 5,1,1
???.??.?#???. 1,4
?????????.?? 3,1,2
.??#?..??#?? 4,3
??#.??#?.??????..? 2,1,1,1,2,1
??#???.??#??#.?#?#?# 3,1,6,2,3
.???##.?.???? 2,2,1
???#???##?#??#? 3,8
.???????????#?#? 1,1,1,1,6
?.?.?????? 1,1,1
?.#?.??????????#? 1,1,4,1,3
??#..???.???#?? 1,1,2,3
????????????? 1,3,4
???.?#?#.. 1,3
?#???.??.?. 1,1,1
.??????#???????. 1,6,3
.?#.??#????.#?#????# 2,4,8
???????.#?#. 2,1,1,1
??????.#??? 1,1,2
?.??##????#.?#? 9,2
?.??????#????.????.. 7,4
#?##?????#?? 1,3,3,1
?#??#??###??.#?? 5,3,1,1
????.#..??#???? 3,1,1,1
#??#?.#?#??#?..# 1,3,4,2,1
?????#???###.? 2,7
?????.?????????.#. 2,1,8,1
.#.????.?#??? 1,1,1,2
????.?????? 1,2,3
?#???#?##????#???.?? 1,9,4,2
????#???#?#??????? 12,2
.?#?????.#? 2,3,1
?..????.?.#??????#? 1,1,1,1,7
??????...?#??? 2,1,3
?????.#??#?.?#?# 1,1,1,1,3
#????#???#???#?.. 2,2,6
?.?.??.??.? 1,1,2
??.#????????#?????? 1,2,12
.##??.#????..###?. 3,3,4
??#?#????#???#?? 9,1,1
?#??.?.?#???#?#? 1,1,9
??##?#?#????? 1,4,3,1
.?????#?.? 1,1,1
.??????#????.?##???# 2,4,2,3,1
?.???#?????? 1,5
?..??.#.?????????.? 1,5
?#?.#??.???#???# 1,1,2,1,2
#??#???..????. 6,3
???#????????. 7,1
???????#??.?#??.# 1,7,1,1,1
??????#??. 4,2
??.??##????#??.#???? 1,5,3,1,1,1
.##?#????????##?.?? 4,3,3,1
.?..??.??.?.??? 1,1,2
.??????##.????#?#.? 1,5,1,5
..#??.##??.??? 2,4,1
.?#??##???????????. 9,4
#??.??###.??.???#? 2,4,1,3
?????????????? 1,1,1,5
.??????#?#????##? 4,3,3
.??..??##??.# 1,1,3,1
??..##??????#?#?.? 5,5,1
????###??#?..#?.?? 1,4,2,1,1
???.#?????? 1,5
.??#?????????.??.?? 1,9,1
?..#???.????? 1,4
???????.?? 2,1,1
#?..???#???#??? 2,5,4
?????.??????#??#??.? 2,1,2,2,2,3
??.?????.?. 1,3
??.??#???#??.#? 1,1,1,5,2
#.??#??.??#?.?.??? 1,3,1,2,1,1
?..???.?#???.#? 1,1,3,1
?.?.##.#??#??# 1,2,7
?#.??.??#?#??. 1,1,5
.?#?????.?##?#?#.??? 5,6,3
???#.??.?#??. 1,1,1,3
##?##?.??##????? 6,5,1
?##????###??#?? 4,7
#?#?##??#????????#? 3,2,11
..?????#?## 2,5
.??#?..?##????#. 2,2,3
????????#???????? 4,1,7,1
?#??#.?.?.? 1,2,1
#?.?#.?#?.?#?????? 2,1,2,4,1
?.??#.##??##??? 2,9
????#????..??#? 3,3,1,1,2
#????#??????## 1,3,6
?..????????.? 2,4
??#.?????.#?. 3,1,1,2
?????.??#????? 3,3,1
??..?#???# 1,1,2
???.?#?#?#??? 2,8
??????#?.#? 2,4,1
##.????#???????.?# 2,1,1,1,6,1
???##?????????## 2,5,2
?#?#?????????????# 6,4,1,1
#??..?##?###??.? 2,9
?.?????#???.. 1,2,1,1
???.??#.?????. 2,1,2
???????.?? 1,1,1
???#?.??#???.??#.? 5,6,1
.?????#?#??.#.?? 1,1,5,1
???????????.. 4,1,2
????#?.?????###????? 1,4,1,5,3
?????#????????..?? 1,7,1,1
#?##?.???. 5,2
??#???#???#???????# 1,9,1,1
???#??#???###??##? 5,7
.??????#?. 1,3
??.?????#??????.?#?? 2,8,1,1,1
?.#???#??#?#??.???? 12,1
????#.???#.#?????#?. 2,1,3,3,3
?#.???.??.#??#?.? 2,1,1,5,1
??..?#??.????#?##?? 3,9
#???#???????#?..? 9,3,1
.??#?????.?? 3,4
?????????#???.? 4,1
?.?.??.????#??. 1,1,2,4,1
.##?????????.???#? 3,2,1,4
..#????.##???? 1,1,5
??##?.#.?. 3,1
.?.???#?#?..?.????? 3,3
??????????#?#?????? 13,1
??#????????.# 2,2,1,1
.??..#??#.?#. 1,4,1
.????##??#??? 1,1,7
?#???#??????#? 1,3,3,2
.?????????????? 2,1,7
??#???????.? 3,2
#??#?.?????##?#? 2,2,2,2,2
#?##.??.?##?. 1,2,1,2
.??????#??#?.???? 1,6,1,1
.???#???##.?.?##..? 9,2
#???#..???### 5,4
.?#?.?#??.??#.?? 3,2,2
..#?#..???##? 3,1,3
##??##???##.??? 2,4,2,1,1
??##?.#????..????. 4,3,3
.??#?????.?.???# 3,2,1,1
.??#?????????????##? 3,12
??.???#.???..#?# 1,2,2,3
????.???#.? 1,1,3
?#.????#?? 2,5
?###???#????????? 4,3,1,3
???.????##?????#??? 1,1,7,1,2
???.?.????? 2,3
???.???#?# 1,4
????.#?????#??? 1,3,2,2
????#??#??#?#.?..? 1,1,1,7,1,1
.?.#?##?.?????#??. 1,4,1,4
?.?#??.?.?. 1,3,1
?.?#.????#??#??##?#? 2,13
.?#??#??#? 3,4
????#??#???. 3,1,4
?.???#???.? 4,1
???????#?#? 1,2,5
?????#??#???..?? 3,5,1,1
###????.??????? 4,1,1,1,1
.??????#?#??#????#?? 7,6
..?.??????? 1,1,2
.???.?.#??#???#???.# 1,1,5,4,1
???.#?#??#???????? 1,4,1,1,2
????#?#?#?##???#.? 14,1
##?#??????????#?#. 4,1,9
?????#??#. 1,1,1
.??????#???.?? 6,2
?????.??.#.#???????? 3,1,1,1,7
??.#??.###? 1,3
?#?#?#??#? 5,2
?.???????? 2,3
???.#?.????? 1,2,1,1
.????..?#? 2,2
????.?#????? 2,5
.??#?.?????????#? 2,3,6
??????.????##?#? 1,6
#??#??#.?.???????? 1,1,1,1,8
???.#???????? 3,3,1,1
???##???#??#? 6,1,1
.????#???#.? 1,6
????...#??#?????#?.? 3,10
.????#?????????.?? 8,1,2,1
??????.????#?. 2,3
...?#??????#??? 2,6
?#????????###??????? 6,10,1
#?#??#??.?????#??#? 8,9
?.#??...#?? 1,2
????##.?#.# 6,1,1
?.#??..?## 2,3
???.????.????? 3,2
???????#???#??#???#? 1,2,1,1,1,6
???#??????.?. 4,1
#??##??#####??#??? 13,3
??.?.#?????#.????#? 2,4,2,3,2
#?????##?????? 1,1,4,2
#?????#?#???#?.###. 3,6,1,3
.?#???????. 1,1,2
????#??#?#..##?..? 7,3
.???##..?##??? 5,2
???#?##??#?#? 1,2,7
#####????.? 5,2,1
##??#?.???#? 2,2,1,2
?##?#.#????.??#? 4,4,1
???????#?.? 1,1
#????????#?#? 6,4
.?.??.?????#? 1,1,1,5
.?#?##.?????#? 5,4,1
..???.??#.. 2,3
##?#?????.?.???? 4,1,1,2
???#????#??? 5,1
?##??.?.???.#?. 4,1,1,1
.?#?.???????#?##. 1,4,5
####??#???????? 5,2,1,1,1
.###?.?##???. 4,5
??#?##????.??#?.? 10,1,1,1
?#????##.???.#??#.?? 8,1,1,1,2
#??.?.??#??#??..??? 2,1,1,4,1,1
??.?#?#?????. 5,2
????##..#?.?????.? 1,4,1,2,1
?#???????#??#??. 5,5,2
??????????#???????? 1,3,2,1,1,2
.?#??.???..? 1,1,1,1
??????###?.??.?# 1,1,3,1,1
??????.??#???? 3,1
?##..#..?? 2,1,1
.??..?..???? 1,1,1,1
????????????????# 8,2,1,1
?#?.????#????? 3,9
?????.?#??.??#?? 5,3,3
???#.?#???#??#???? 3,10
.?..???#?? 1,1,1
?#?..??.#?. 3,1,1
???.??#????.?????? 1,1,5,1,1,1
??#..??.#????????.? 1,1,1,5,1,1
?????????#??##???? 6,8
..???.?#????????? 1,1,6,1
?..?#??#??????. 1,7,2
???.#????#??????.# 3,1,1,1,4,1
??.????.?#?.??#????? 1,1,2,8
.?.??####?#???.. 5,3
??????.?#? 1,1,2
.??..????? 1,1,1
.???##??#?#.???? 9,2
??#?????#???# 6,5
?.????#???????##. 1,10
????#?.#???? 4,3
????????##? 2,3,2
#??#???????#? 1,3,2,2
?.???##??#?.??##?? 5,1,5
????????????##? 3,2,1,3
??????????##..??? 5,5,2
.##?#??????#???# 5,7
?????.##???##??? 3,10
??#.???#?????? 1,5,1
???????#?????.?# 4,2,2,2
???.????#?#?#?.?? 1,1,1,5,1
#??#?????.#?.?? 2,2,1,2,1
?.##??..???#??# 1,2,1,4,1
?##?.?..??..?? 3,1,1,1
?.#??????#??#? 2,1,6
?.#???.?.?.#??? 1,4,1,1
???.?????#? 2,1,2
?##??#????? 5,3
#?.?????.????. 1,3,3
?.???????.#.? 1,2,2,1
??.?#?????# 1,3,3
...?#??????????? 2,1,3
?#??.#???#????.?.? 2,5,3
.????#??#?#????# 1,6,2
.#???##????????.???# 11,1,1,1
???????????.??? 1,1,2,2,3
??#??.??????? 2,4
???#??.?#??????? 1,1,1,3,5
#?#?#???###?????.?? 1,10,1,1
?????##.##??? 1,3,2,1
???????#?#???#. 2,7
???#.?????. 1,1,2
??.?#.????#?????#?? 2,1,10
?#.???.???.##? 1,2,2,2
??#????????#??? 5,6,1
????#??.??? 4,2
??#?#?????##? 1,1,1,3
?#?.?.?#???#??????? 1,6,1,1,1
???##????#?.??? 9,1
??.???.???.???? 2,1,3,3
??#???#.???? 7,1,1
??.????#.?. 1,2
??????#??##??? 2,2,3,1
?#??.?#?.?.??????.?? 2,1,2,1,3,1
?????##?.#??? 1,1,3,1
?.??#???.#? 3,1
#?.???.?###??####.?. 2,3,10,1
?.#????#.?#????? 1,4,1,2,1
.?????.???#..#.?? 1,1,4,1,1
???#??#??.#???. 7,4
??##??????????? 6,5
??#??.??#??#????# 2,6,1
.?#???.?..??#. 3,1,1,1
?#??????#.?#?.?.?# 2,2,1,1,1,1
?.#?.??.????## 2,1,4
??.??###???????????? 1,13,1
?#?????#?.?##? 2,1,2,2
????#?.?.?.##?? 4,1,1,2
#.?.??#??? 1,1,2
??????.???#?? 3,3
???.???##? 2,1,3
..?????.?.?#?? 2,3
??.?#??##?##??#.??# 2,1,6,2,2
??#?????.?#??#??? 4,1,4,1
##???????????.??? 2,8,2
?.????..???.?? 2,1
????.????#??? 1,1,2,1
??????#?#?????#?? 6,1
????#?.??????? 3,1
.?#??##?.#???? 7,2,2
???#?#.??#???????. 1,1,7,1
???#?????#. 2,2,1
#??????#.?????#??.? 3,1,1,1,4,1
?#??????.????? 2,2,3
????????#???????.? 2,6,4
#?.???.??.??#??? 1,1,1,1,4
?????????#.?# 1,5,1
????#??#?????# 2,1,6,1
.?????#?????#????? 1,3,1,1,1,1
#??#??.??#????? 6,2,3
??.??????.??. 2,6,1
?#??#???###...#?? 5,3,2
?#?#..???????????? 2,1,4,1,1,1
????##????.??#????. 4,5
??#?.???.?#??? 1,1,1,4
?????.??.????#.# 3,2,1,2,1
?.????????? 1,6,1
#??##????#???? 1,8,1
?#??.??##? 1,1,3
.????#???????.?#?# 1,3,1,2,1,1
???###????#?? 8,1,1
??#????.???# 3,3,3
.??#?????.?.??.??? 3,2,1,2,1
.#???#?##???.??#.?? 1,1,4,1,1,1
##?????#????? 8,3
????.??.?? 1,1,1
?.???.???##?#??#? 2,9
??..????#???? 1,2,3,1
.???#????#?.?????..? 8,1
.?????.?#?. 1,1
#????##????? 7,1
??????#.#?#?#?? 5,5
.#???.??.#?????#??. 4,2,8
??#?#?#?..???#??? 1,6,5,1
?#?.#?.????. 1,1,3
#?????#??#?##??.?#?. 14,3
??..??##??. 2,5
..#????.#?.????? 4,2,2
##?#??#.?# 7,1
?#?.?##?#? 1,6
.?#???.?#???#? 4,7
?..?????#####??.??? 1,2,7,3
?????#????#?????.?? 8,1,1,1,1
???????##?.??? 7,2
??.???#?##?#?.??? 1,8,2
?????##??? 2,3,1
?#.?.??##???????#?? 2,5,3
?#??????.??#?? 8,3
?#?#??#????.????.? 4,4,1
???##????# 6,1
??????????? 2,5
??????.???.#????##? 3,1,7
?#..?.??#??#??? 1,1,3,2
.?.???#..?#. 1,1,2,2
??.#??.###? 1,1,4
?##?##???? 7,1
?#??#.????..?##? 1,2,3,4
..?##???#????#..#? 3,4,2,1
?.#.??????.#?.#???? 1,1,3,2,3
#?#??????? 3,4"""

example3 = """.??..??...?##. 1,1,3"""

# Task one:
# For each row, count all of the different arrangements of operational and broken springs 
# that meet the given criteria. What is the sum of those counts?

from itertools import product

def checkCombination(combination, numbers):
    counter = 0
    localNumbers = []
    for i in range(len(combination)):
        if combination[i] == "#":
            counter += 1
        if (combination[i] == "." or i == len(combination)-1) and counter > 0:
            localNumbers.append(counter)
            counter = 0
    # print(numbers)
    # print(combination)
    # print(str(localNumbers) + "\n")
    if localNumbers == numbers:
        return True
    else: return False

def calculatePossibilities(string):
    sum = 0
    for line in string.split("\n"):
        possibilities = 0
        numbers = []
        for i in line.split():
            for j in i.split(","):
                if j.isdigit():
                    numbers.append(int(j))
        # print(numbers)
        hotsprings = [x for x in line if x == "." or x == "#" or x == "?"]
        questionmarks = []
        for i in range(len(hotsprings)):
            if hotsprings[i] == "?":
                questionmarks.append((i,[".","#"]))
        
        possibilitiesForHotSprings = [possibilities for _, possibilities in questionmarks]
        combinations = product(*possibilitiesForHotSprings)
        for combination in combinations:
            applied = []
            counter = 0
            for i in hotsprings:
                if i == "?":
                    applied.append(combination[counter])
                    counter += 1
                else: applied.append(i)
            if checkCombination(applied, numbers):
                possibilities += 1
        sum += possibilities
        #print("sum " + str(sum))
    return sum


# Task two:
# To unfold the records, on each row, replace the list of spring conditions with five 
# copies of itself (separated by ?) and replace the list of contiguous groups of damaged 
# springs with five copies of itself (separated by ,).

from tqdm import tqdm

def dynamic(line, value):
    value.append(0)

    maxV = max(value)
    line += "."

    n = len(line)
    m = len(value)
    dp = [[[None for _ in range(maxV+1)]
           for _ in range(m)] for _ in range(n)]
    
    for i in range(n):
        x = line[i]
        for j in range(m):
            for k in range(value[j]+1):
                if i == 0:
                    if j != 0:
                        dp[i][j][k] = 0
                        continue

                    if x == "#":
                        if k != 1:
                            dp[i][j][k] = 0
                            continue
                        dp[i][j][k] = 1
                        continue

                    if x == ".":
                        if k != 0:
                            dp[i][j][k] = 0
                            continue
                        dp[i][j][k] = 1
                        continue

                    if x == "?":
                        if k not in [0, 1]:
                            dp[i][j][k] = 0
                            continue
                        dp[i][j][k] = 1
                        continue
                # Process answer if current char is .
                if k != 0:
                    ansDot = 0
                elif j > 0:
                    assert k == 0
                    ansDot = dp[i-1][j-1][value[j-1]]
                    ansDot += dp[i-1][j][0]
                else:
                    # i>0, j=0, k=0.
                    # Only way to do this is if every ? is a .
                    ansDot = 1 if line[:i].count("#") == 0 else 0

                # Process answer if current char is #
                if k == 0:
                    ansPound = 0
                else:
                    # Newest set
                    ansPound = dp[i-1][j][k-1]

                if x == ".":
                    dp[i][j][k] = ansDot
                elif x == "#":
                    dp[i][j][k] = ansPound
                else:
                    dp[i][j][k] = ansDot + ansPound

    add = dp[n-1][-1][0]
    
    return add

def calculatePossibilities2(string):
    sum = 0
    lines = []
    values = []
    for line in string.split("\n"):
        line = line.split(" ")
        line[0] = "?".join([line[0]] * 5)
        line[1] = ",".join([line[1]] * 5)
        lines.append(line[0])
        values.append([int(i) for i in line[1].split(",")])

    for line, value in list(zip(lines, values)):
        add = dynamic(line, value)
        sum += add
    return sum


if __name__ == "__main__":
    print("Result with function calculatePossibilities")
    print("Example 1:")
    print(calculatePossibilities(example1))
    print("Example 2:")
    print(calculatePossibilities(example2))
    print("Result with function calculatePossibilities2")
    print("Example 3:")
    print(calculatePossibilities2(example3))
    print("Example 2:")
    print(calculatePossibilities2(example2))